# RailsとJavascript
ここではRailsを利用する際のJavascriptの使い方について解説していく

# 8-1 Javascriptでページに変化をつける
まずは、タスク一覧画面にJavascriptで動きをつけてみる。
タスクの1つにカーソルを合わせたときに対応するセルの背景色を変えるということを目指す。

タスク一覧表のテーブル内のセルはHTMLのtd要素で構成されている。
そのため、td要素の部分にカーソルを合わせたときにその背景書を変えることができれば良さそう。
そのためのJavascriptを記述する。

新しくtasks.jsというファイルを作成し、処理を記述していく。


## 8-2 AjaxでRailsサーバと通信する
8-1ではJavaScriptでページに動きをつけていたが、その処理はJavaScriptの中で完結していた。
しかし、実現したい処理の内容によっては、サーバ側からデータを新たに取得したり、データを裏で更新したいと言った場合もある。

このようなことを実現するために利用する便利な仕組みがAjax。
Ajax: webブラウザ上で非同期通信を行い、ページの読み込みなしにページを更新するためのJavascriptのプログラミング手法。

ここでは実際にRailsのAjax機能を使って、前章までに作成したタスクを削除し、画面に反映する方法を見ていく。

## Ajaxでタスクを削除する
今まではブラウザから削除のためのリクエストを行い、その中では、タスクを削除した上で一覧画面にリダイレクトするようになっていた。

削除機能でやりたいことは次の2つに集約できる
1. タスクを削除する
2. タスクが削除されたことを反映した一覧画面を表示する

### Ajaxでタスクを削除するための作戦
今の実装はブラウザから1つのPOSTリクエストを送ることで実現している
これを次のように変更する

- タスクの削除はサーバサイドでやる必要があるものの、今表示しているタスク一覧画面をそのまま表示続けていたため、Ajaxでサーバにリクエストを飛ばず
- 次に削除されたタスクの非表示は、クライアントサイドにてJSで行う。1の処理が行われたら非表示になるようにする

### ページ遷移ではなくAjaxリクエストを発生させる
早速実装していく
Ajaxで削除アクションへリクエストを飛ばすために、index.html.slimを変更する

```
= link_to '削除', task, method: :delete, remote: true, data: {confirm: "タスク「#{task.name}」を削除します。よろしいですか?"}, class: 'btn btn-danger'
```

remote: trueオプションを加えると、Railsが自動的にAjaxでサーバにリクエストを送信できるようにしてくれる。

### destroyアクションをAjax向けに変更する
次にAjaxリクエストを受け取ってタスクの削除を行うTasksController#destroyを修正していく。
今回はサーバサイドではタスクを削除すればよく、一覧画面の再表示は不要。このため、redirect_toの行を削除し、代わりにheadメソッドを用いてレスポンスボディ無しでHTTPステータスとして204が変えるようにしておく。

```
    @task.destroy
    head :no_content
```

### 削除したタスクを非表示にする
railsバージョン違いで上手く行かないので一旦割愛



# 8-3 Turbolinks
Railsが提供するjavascript機能の中には、ページ遷移を高速化する仕組みもある。
それがTurbolinks

Turbolinks: 全てのリンククリックに対するページ遷移を自動的にAjax化することで高速化を図る。

仕組みを簡単に説明すると、a要素のクリックイベントをフックして、遷移先のページをAjaxで取得する。
そして取得したページが要求するJavaScriptやCSSが現在のものと同一であれば現在のものはそのまま利用し、title要素やbody要素に置き換える。

# 8-4 モダンなjavascript管理を行う

## Yarn
Facebookにより開発されたJSのパッケージマネージャ。
パッケージ: ライブラリの公開単位。コードなどのファイルをひとまとめにしたものを指す。
今まではnpmがよく使われてきたが、Yarnはnpmより高速に動作し、またチェックサムを使ってライブラリの内容に予期せぬ変更が加わっていないことを確認してくれるためセキュリティが高いという特徴がある。

## webpacker
JSのビルドツール「webpack」のラッパーで、Railsアプリケーションでwebpackを使ってJSを管理することを簡単にしてくれるGem
